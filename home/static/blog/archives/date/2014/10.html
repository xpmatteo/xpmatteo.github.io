<!DOCTYPE html>
<html>


<!-- Mirrored from matteo.vaccari.name/blog/archives/date/2014/10 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 24 Sep 2021 09:58:12 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="initial-scale=1">

<title>Extreme Enthusiasm   &raquo; 2014 &raquo; October</title>

<meta name="generator" content="WordPress 5.1.1" /> <!-- leave this for stats -->

<link rel="stylesheet" href="../../../wp-content/themes/mv2/style.css" type="text/css" media="screen" />
<link rel="alternate" type="application/rss+xml" title="Extreme Enthusiasm RSS Feed" href="../../../feed" />
<link rel="pingback" href="../../../xmlrpc.php" />

<link rel='dns-prefetch' href='http://s.w.org/' />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11.2.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11.2.0\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/matteo.vaccari.name\/blog\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.1.1"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='wp-block-library-css'  href='../../../wp-includes/css/dist/block-library/style.min3c21.css?ver=5.1.1' type='text/css' media='all' />
<link rel='https://api.w.org/' href='../../../wp-json/index.html' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../../xmlrpc0db0.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../../../wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.1.1" />
</head>
<body>
<div id="page">

<div id="header">
	<h1><a href="../../../../blog">Extreme Enthusiasm</a></h1>
</div>

<div id='maincontent'>
  <div id='main-col'>

		
				<h2 class="pagetitle">Archive for October, 2014</h2>

		
		<div class="navigation">
			<div class="alignleft"></div>
			<div class="alignright"></div>
		</div>

				<div class="post">
				<h3 id="post-912"><a href="../../912.html" rel="bookmark" title="Permanent Link to Another example of Object Theater">Another example of Object Theater</a></h3>
				<small>Thursday, October 30th, 2014</small>

				<div class="entry">
					<h3>Mastermind</h3>
<p>This year I gave my Web Applications students the task of writing a <a href="http://en.wikipedia.org/wiki/Mastermind_(board_game)" title="Mastermind (board game) - Wikipedia, the free encyclopedia">Mastermind</a> game.  You can see some of their work <a href="http://aw-resconi.herokuapp.com/" title="Mastermind">here</a>, <a href="http://aw-comolli.herokuapp.com/" title="Mastermind">here</a> and <a href="http://aw-pistocchini-scapinello.herokuapp.com/" title="Mastermind">here</a>.  The game works like this: the computer starts a new game by inventing a random secret code, composed of 4 digits from 1 to 6.  For instance: 5414.</p>
<p>The player must deduce what is the secret code by trying guesses.  To continue the example if my first guess is 1234, the computer will answer &#8220;-+&#8221; which means that I got one number right (+) and another number is present in the secret code but in a different position (-).  Of course, I don&#8217;t know which!  I can then try more guesses, until I have enough clues to guess right.</p>
<p>You get a score for each completed game, that is equal to the number of guesses.  Of course, the lower the score, the better.</p>
<p>A player will earn a score that is the average of all the games he or she completed.</p>
<h3>Procedural!</h3>
<p>Teaching Object-Oriented programming was <em>not</em> one of the goals of the course.  Therefore, most programs I got were <em>very</em> procedural. (Please note that the example that follows is from a <em>good</em> student and his work earned a very high score in my course.  It was a good web application, even though it was not object-oriented).</p>
<p>I&#8217;d like to show an example of procedural code.  This is a controller object that handles a &#8220;guess&#8221;.</p>
<pre><code>public void guess() throws IOException {
  String gameId = request.getParameter("game_id");
  String code = gamesRepository.findSecretCode(gameId);
  String guess = request.getParameter("guess");
  String answer = compareCodes(code, guess);
  String player = gamesRepository.find_game_player(gameId);
  guessesRepository.createGuess(gameId, player, guess, answer);
  gamesRepository.incrementGameScore(gameId);

  // if game is won
  if(answer.equals("++++")){
    gamesRepository.setFinished(request.getParameter("game_id"));
    int oldScore = gamesRepository.getPlayerScore(player);
    playersRepository.addFinishedGame(player, oldScore);
  }

  // return json data
  response.getWriter().write(toJson("answer", answer));
}
</code></pre>
<p>This is classic procedural code; the game logic is found in the controller (method <code>compareCodes()</code>) and the repositories (three repositories!).  There are no domain objects.</p>
<p>The database structure is something like</p>
<pre><code>       1      *      1      *
player -------- game -------- guesses
</code></pre>
<p>The gameRepository adds a row to the games table when a new game is added.  The guessesRepository adds a row to the guesses table when a new guess is guessed.  The controller must take care to call the proper repositories at the right time.  The controller &#8220;knows&#8221;  the database structure; if the database structure changes, the controller code will probably also change.</p>
<h3>Object-Oriented</h3>
<p>What I&#8217;d like to do instead is</p>
<ul>
<li>Domain objects that handle all the game logic</li>
<li>No logic in the repositories or the controller</li>
<li>Just one repository is enough, thank you.  The repository should take care of adding rows to the proper tables.</li>
</ul>
<p>The domain object should probably be the MasterMind game.</p>
<pre><code>game.guess(request.getParameter("guess"));
</code></pre>
<p>The &#8220;guess&#8221; message is what sets the domain logic in motion.  The controller should not need to know anything else.</p>
<p>Q. What if the game is won?  Who updates the player&#8217;s score?</p>
<p>A. The game object should do that.</p>
<p>Q. Where do we see that the game updates the player&#8217;s score?</p>
<p>A. Not in the controller.  The controller does not know or care.  Handling victories is something that is done in the game object.</p>
<p>Q. Really! How do we update the player&#8217;s score?</p>
<p>A. The game probably knows its player, and tells it to update its score if the game is won.</p>
<p>Q. How does the game get a reference to its player?</p>
<p>A. The controller does not know.  But see next question.</p>
<p>Q. Where do we get the game object from?</p>
<p>A. From a repository, of course.  We suppose that the repository will return it with all the dependencies that it needs to have.  If the game needs a reference to its player, the repository must take care to set it up.</p>
<pre><code>String gameId = request.getParameter("game_id");
Game game = gamesRepository.findGame(gameId);

game.guess(request.getParameter("guess"));
</code></pre>
<p>Q. How is the state of the game persisted?</p>
<p>A. By asking the repository to save the game.</p>
<pre><code>// Here we are in the infrastructure world
String gameId = request.getParameter("game_id");
Game game = gamesRepository.findGame(gameId);

// Now we pass to the realm of pure domain logic
game.guess(request.getParameter("guess"));

// And now we return to the infrastructure world
gamesRepository.save(game);
response.getWriter().writer(toJson(game));
</code></pre>
<p>So we have seen another example of <a href="../../904.html">object theater</a>.  The infrastructure details are dealt with before and after the main action.  The main action is sending &#8220;guess&#8221; to the game object.  There is where the functional requirements is dealt with.  Before that, and after that, is infrastructure code that deals with non-functional, performance requirements.</p>
				</div>

				<p class="postmetadata">Posted in <a href="../../category/agile.html" rel="category tag">Agile</a> |   <a href="../../912.html#respond">No Comments &#187;</a></p>
		</div>

				<div class="post">
				<h3 id="post-904"><a href="../../904.html" rel="bookmark" title="Permanent Link to Object-Oriented Theater">Object-Oriented Theater</a></h3>
				<small>Thursday, October 30th, 2014</small>

				<div class="entry">
					<blockquote><p><strong>Update 30/10/14</strong>: I first read about the &#8220;Object Theatre&#8221; in <a href="https://groups.google.com/forum/#!topic/growing-object-oriented-software/eFfT7orRrdk%5B76-100-false%5D">a message by Anthony Green</a> on the GOOS mailing list; I didn&#8217;t remember it consciously when I wrote this post, but it certainly has been working in my brain ever since.  The &#8220;Object Theatre&#8221; metaphor is his invention, not mine.  Thanks <a href="https://twitter.com/kevinrutherford">Kevin</a> and <a href="https://twitter.com/anthonycgreen">Anthony</a> for <a href="https://twitter.com/anthonycgreen/status/527896910083141633">pointing it out</a>.
</p></blockquote>
<p>Yesterday evening I attended <a href="https://www.youtube.com/watch?v=41PvxgaZEzk" title="YouTube video of yesterdays' Codemotion Tech Talk">a good introduction on functional programming</a>  by <a href="https://twitter.com/mariofusco">Mario Fusco</a>.  One of his slides illustrated a well-known principle of functional programming.  There are pure functions, and &#8220;functions&#8221; with side effects.  Good FP style suggests to keep non-pure functions at the edges of the program, so that the inner core of your program only contains pure, mathematical functions.</p>
<p>He showed this picture</p>
<p><a href="http://www.slideshare.net/mariofusco/if-you-think-you-can-stay-away-from-functional-programming-you-are-wrong/41" title="Outer impure shell, inner pure kernel">http://www.slideshare.net/mariofusco/if-you-think-you-can-stay-away-from-functional-programming-you-are-wrong/41</a></p>
<p>In fact, a very similar picture can be drawn for good object-oriented style.  In good OO style, you want to separate your domain objects from infrastructure objects.  The domain objects contain just domain logic, they execute in memory and have no references to file system, databases or network services.  They can be mutable, of course!  But they are &#8220;pure logic&#8221; in the sense that they live in a platonic world where we are only concerned with the functional behaviour of our programs.</p>
<p>Infrastructure objects, on the other hand, deal with everything else:  user interface, databases, file systems, web services&#8230; All the things that are needed to connect our platonic world of objects to the outside world.</p>
<p>So what&#8217;s good OO style in this context?  In my opinion, it&#8217;s good to keep the infrastructure objects in an outside shell, while the inner core of the program contains only pure domain objects.  Let me give you an example.</p>
<p>Suppose you have a Counter object that needs (for non-functional reasons!) to be made persistent.  The functional logic is about incrementing and decrementing the value of the counter.  The infrastructure logic is about making sure that the counter retains its value across reboots (which is definitely a non-functional requirement.)</p>
<p>The wrong way to do this is</p>
<pre><code>// bad style! don't do this
class Counter {
  public Counter(int id, CounterDao dao) {
    this.id = id;
    this.dao = dao;
  }

  public void increment() {
    value++;
    dao.incrementCounter(id);
  }

  private int value = 0;
  private int id;
  private CounterDao dao;
}
</code></pre>
<p>The usage of this counter would be</p>
<pre><code>CounterDao dao = ...;
Counter counter = new Counter(123, dao);

// here we perform logic and also persist the state
counter.increment();
</code></pre>
<p>The above example is bad style, because it mixes persistency logic with functional logic.  Bah!  A better way to do it is:</p>
<pre><code>class Counter {
  public void increment() {
    value++;
  }
  private int value = 0;
}
</code></pre>
<p>See?  Only pure logic.  We don&#8217;t care about persistency there.  We could use the counter this way:</p>
<pre><code>// we start this use case in the world of infrastructure
CounterDao dao = ...;
Counter counter = dao.findCounter(id);

// here we enter the world of pure logic
counter.increment();

// here we return to the world of infrastructure
dao.save(counter);
</code></pre>
<p>I like to call this structure &#8220;object theatre&#8221;.  Imagine your domain objects as actors in a play.  You want to setup a scene where your actors are set up in a certain way: <a href="http://www.teatrolemaschere.it/wp-content/gallery/arlecchino-e-colombina-nel-teatrino-dei-burattori/burattori_compresse_002.jpg" title="Arlecchino and Colombina (picture)" target="_blank">Arlecchino talks to Colombina, Colombina has a fan in her hand, etc</a>.  When the scene starts, the actors perform each according to their character.  When the scene ends, we lower the curtain.</p>
<p>I imagine that an object-oriented system works the same way.  When a request arrives, we set up the scene by retrieving all the proper objects from various repositories and we connect them appropriately.  This is setting the scene.  Then we send a message to one object that sets some logic in motion. The objects send messages to each other, carrying out a computation.  This is playing out the scene.  When the domain objects are done, we conclude by returning the objects to their respective repositories.  This is lowering the curtain.</p>
				</div>

				<p class="postmetadata">Posted in <a href="../../category/agile.html" rel="category tag">Agile</a>, <a href="../../category/expressive-code.html" rel="category tag">Expressive Code</a> |   <a href="../../904.html#comments">5 Comments &#187;</a></p>
		</div>

		
		<div class="navigation">
			<div class="alignleft"></div>
			<div class="alignright"></div>
		</div>

	  	</div>

  <div id='right-col'>
        <div id="sidebar">
    <ul>

      <li>
        <form method="get" id="searchform" action="http://matteo.vaccari.name/blog/">
  <div>
    <input tabindex="1" type="text" value="" name="s" id="s" />
    <input type="submit" id="searchsubmit" value="Search" />
  </div>
</form>
      </li>

      <li>

        <h2>About</h2>

	I am a software developer working with <a href="http://thoughtworks.com/">Thoughtworks Italia</a>.
        I'm a fan of <a
        href="http://extremeprogramming.org/">Extreme Programming</a>.
        I&nbsp;helped organize the <a
        href="http://essap.dicom.uninsubria.it/">European Summer School on
        Agile Programming</a>

      </li>

      <li>
            <p>You are currently browsing the <a href="../../../index.html">Extreme Enthusiasm</a> weblog archives
      for October, 2014.</p>

            </li>

      <li class="pagenav"><h2>Pages</h2><ul><li class="page_item page-item-851"><a href="../../../selected-tdd-resources-to-start.html">Selected TDD Resources To Start</a></li>
<li class="page_item page-item-583"><a href="../../../tdd-resources.html">TDD Resources</a></li>
<li class="page_item page-item-247"><a href="../../../the-hexagonal-architecture.html">The Hexagonal Architecture</a></li>
</ul></li>

      
      <li><h2>Archives</h2>
        <ul>
        	<li><a href='../2018/10.html'>October 2018</a></li>
	<li><a href='../2017/09.html'>September 2017</a></li>
	<li><a href='../2016/08.html'>August 2016</a></li>
	<li><a href='../2016/03.html'>March 2016</a></li>
	<li><a href='../2016/01.html'>January 2016</a></li>
	<li><a href='12.html'>December 2014</a></li>
	<li><a href='10.html'>October 2014</a></li>
	<li><a href='06.html'>June 2014</a></li>
	<li><a href='02.html'>February 2014</a></li>
	<li><a href='../2013/12.html'>December 2013</a></li>
	<li><a href='../2013/11.html'>November 2013</a></li>
	<li><a href='../2013/06.html'>June 2013</a></li>
	<li><a href='../2013/05.html'>May 2013</a></li>
	<li><a href='../2013/03.html'>March 2013</a></li>
	<li><a href='../2013/02.html'>February 2013</a></li>
	<li><a href='../2012/10.html'>October 2012</a></li>
	<li><a href='../2012/08.html'>August 2012</a></li>
	<li><a href='../2012/07.html'>July 2012</a></li>
	<li><a href='../2012/06.html'>June 2012</a></li>
	<li><a href='../2012/05.html'>May 2012</a></li>
	<li><a href='../2012/04.html'>April 2012</a></li>
	<li><a href='../2012/01.html'>January 2012</a></li>
	<li><a href='../2011/12.html'>December 2011</a></li>
	<li><a href='../2011/11.html'>November 2011</a></li>
	<li><a href='../2011/10.html'>October 2011</a></li>
	<li><a href='../2011/07.html'>July 2011</a></li>
	<li><a href='../2011/06.html'>June 2011</a></li>
	<li><a href='../2011/05.html'>May 2011</a></li>
	<li><a href='../2011/04.html'>April 2011</a></li>
	<li><a href='../2011/03.html'>March 2011</a></li>
	<li><a href='../2011/02.html'>February 2011</a></li>
	<li><a href='../2010/11.html'>November 2010</a></li>
	<li><a href='../2010/10.html'>October 2010</a></li>
	<li><a href='../2010/09.html'>September 2010</a></li>
	<li><a href='../2010/08.html'>August 2010</a></li>
	<li><a href='../2010/07.html'>July 2010</a></li>
	<li><a href='../2010/06.html'>June 2010</a></li>
	<li><a href='../2010/05.html'>May 2010</a></li>
	<li><a href='../2010/04.html'>April 2010</a></li>
	<li><a href='../2010/03.html'>March 2010</a></li>
	<li><a href='../2010/02.html'>February 2010</a></li>
	<li><a href='../2010/01.html'>January 2010</a></li>
	<li><a href='../2009/12.html'>December 2009</a></li>
	<li><a href='../2009/11.html'>November 2009</a></li>
	<li><a href='../2009/10.html'>October 2009</a></li>
	<li><a href='../2009/09.html'>September 2009</a></li>
	<li><a href='../2009/07.html'>July 2009</a></li>
	<li><a href='../2009/05.html'>May 2009</a></li>
	<li><a href='../2009/04.html'>April 2009</a></li>
	<li><a href='../2009/03.html'>March 2009</a></li>
	<li><a href='../2009/02.html'>February 2009</a></li>
	<li><a href='../2009/01.html'>January 2009</a></li>
	<li><a href='../2008/12.html'>December 2008</a></li>
	<li><a href='../2008/11.html'>November 2008</a></li>
	<li><a href='../2008/10.html'>October 2008</a></li>
	<li><a href='../2008/09.html'>September 2008</a></li>
	<li><a href='../2008/07.html'>July 2008</a></li>
	<li><a href='../2008/06.html'>June 2008</a></li>
	<li><a href='../2008/05.html'>May 2008</a></li>
	<li><a href='../2008/04.html'>April 2008</a></li>
	<li><a href='../2008/01.html'>January 2008</a></li>
	<li><a href='../2007/11.html'>November 2007</a></li>
	<li><a href='../2007/10.html'>October 2007</a></li>
	<li><a href='../2007/09.html'>September 2007</a></li>
	<li><a href='../2007/06.html'>June 2007</a></li>
	<li><a href='../2007/05.html'>May 2007</a></li>
	<li><a href='../2007/04.html'>April 2007</a></li>
	<li><a href='../2007/03.html'>March 2007</a></li>
	<li><a href='../2007/02.html'>February 2007</a></li>
	<li><a href='../2007/01.html'>January 2007</a></li>
	<li><a href='../2006/12.html'>December 2006</a></li>
	<li><a href='../2006/11.html'>November 2006</a></li>
	<li><a href='../2006/10.html'>October 2006</a></li>
	<li><a href='../2006/09.html'>September 2006</a></li>
	<li><a href='../2006/08.html'>August 2006</a></li>
	<li><a href='../2006/07.html'>July 2006</a></li>
	<li><a href='../2006/06.html'>June 2006</a></li>
	<li><a href='../2006/05.html'>May 2006</a></li>
	<li><a href='../2006/04.html'>April 2006</a></li>
	<li><a href='../2006/03.html'>March 2006</a></li>
	<li><a href='../2006/02.html'>February 2006</a></li>
	<li><a href='../2006/01.html'>January 2006</a></li>
        </ul>
      </li>

      <li><h2>Categories</h2>
        <ul>
        	<li class="cat-item cat-item-1"><a href="../../category/agile.html" >Agile</a> (229)
</li>
	<li class="cat-item cat-item-3"><a href="../../category/books.html" >Books</a> (2)
</li>
	<li class="cat-item cat-item-11"><a href="../../category/design-exercise.html" >Design Exercise</a> (5)
</li>
	<li class="cat-item cat-item-6"><a href="../../category/essay.html" >Essay</a> (13)
</li>
	<li class="cat-item cat-item-8"><a href="../../category/expressive-code.html" >Expressive Code</a> (11)
</li>
	<li class="cat-item cat-item-10"><a href="../../category/fundamentals.html" >Fundamentals</a> (6)
</li>
	<li class="cat-item cat-item-9"><a href="../../category/other.html" >other</a> (1)
</li>
        </ul>
      </li>

      
    </ul>
  </div>

    </div>
  </div>
</div>


<hr />
<div id="footer">
<address>
  <script type="text/javascript">eval(unescape('%64%6f%63%75%6d%65%6e%74%2e%77%72%69%74%65%28%27%3c%61%20%68%72%65%66%3d%22%6d%61%69%6c%74%6f%3a%76%61%63%63%61%72%69%40%70%6f%62%6f%78%2e%63%6f%6d%22%3e%76%61%63%63%61%72%69%40%70%6f%62%6f%78%2e%63%6f%6d%3c%2f%61%3e%27%29%3b'))</script>
</address>
</div>
</div>
  <script type='text/javascript' src='../../../wp-includes/js/wp-embed.min3c21.js?ver=5.1.1'></script>
</body>

<!-- Mirrored from matteo.vaccari.name/blog/archives/date/2014/10 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 24 Sep 2021 09:58:12 GMT -->
</html>
