<!DOCTYPE html>
<html>


<!-- Mirrored from matteo.vaccari.name/blog/archives/407 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 24 Sep 2021 10:26:43 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="initial-scale=1">

<title>Extreme Enthusiasm  &raquo; Blog Archive   &raquo; Test behaviour not syntax</title>

<meta name="generator" content="WordPress 5.1.1" /> <!-- leave this for stats -->

<link rel="stylesheet" href="../wp-content/themes/mv2/style.css" type="text/css" media="screen" />
<link rel="alternate" type="application/rss+xml" title="Extreme Enthusiasm RSS Feed" href="../feed" />
<link rel="pingback" href="../xmlrpc.php" />

<link rel='dns-prefetch' href='http://s.w.org/' />
<link rel="alternate" type="application/rss+xml" title="Extreme Enthusiasm &raquo; Test behaviour not syntax Comments Feed" href="407/feed" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11.2.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11.2.0\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/matteo.vaccari.name\/blog\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.1.1"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='wp-block-library-css'  href='../wp-includes/css/dist/block-library/style.min3c21.css?ver=5.1.1' type='text/css' media='all' />
<link rel='https://api.w.org/' href='../wp-json/index.html' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../xmlrpc0db0.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='The geometry lab &#8212; an exercise' href='395.html' />
<link rel='next' title='Answering Jacopo&#8217;s comment' href='411.html' />
<meta name="generator" content="WordPress 5.1.1" />
<link rel="canonical" href="407.html" />
<link rel='shortlink' href='../indexffa6.html?p=407' />
<link rel="alternate" type="application/json+oembed" href="../wp-json/oembed/1.0/embed2901.json?url=http%3A%2F%2Fmatteo.vaccari.name%2Fblog%2Farchives%2F407" />
<link rel="alternate" type="text/xml+oembed" href="../wp-json/oembed/1.0/embedab91?url=http%3A%2F%2Fmatteo.vaccari.name%2Fblog%2Farchives%2F407&amp;format=xml" />
</head>
<body>
<div id="page">

<div id="header">
	<h1><a href="../../blog">Extreme Enthusiasm</a></h1>
</div>

<div id='maincontent'>
    <div id='main-col'>

  
		<div class="navigation">
			<div class="alignleft">&laquo; <a href="395.html" rel="prev">The geometry lab &#8212; an exercise</a></div>
			<div class="alignright"><a href="411.html" rel="next">Answering Jacopo&#8217;s comment</a> &raquo;</div>
		</div>

		<div class="post" id="post-407">
			<h2><a href="407.html" rel="bookmark" title="Permanent Link: Test behaviour not syntax">Test behaviour not syntax</a></h2>

			<div class="entrytext">
				<p>Another thing that happened when I was last coaching a team on XP techniques.  We were working on a real application, and one thing that we had to do was to serialize a data structure to XML for publishing on a web service.  There are a ton of different ways to do that, but whatever you do, don&#8217;t write tests like this:</p>
<p><code></p>
<pre>
@test public static void serializesToCorrectXml() {
  DataStructure structure = new ....;
  XmlSerializer s = new XmlSerializer();
  String xml = s.serialize(structure);
  assertEquals("&lt;?xml version=\&quot;1.0\&quot;?&gt;&lt;foo&gt;&lt;bar&gt;zot&lt;/bar&gt;&lt;/foo&gt;", 
    xml);
}
</pre>
<p></code></p>
<p>Can you see what&#8217;s bad with this code?</p>
<p>I can name a few things:</p>
<ul>
<li>It doesn&#8217;t scale.  When the data structure grows, the xml string becomes big and difficult to handle</li>
<li>It&#8217;s brittle.  A tiny, insignificant difference in white space will break the test.</li>
<li>It does not express intent.  Look at the name of the test.  We could not come up with anything better than this.</li>
</ul>
<p>The crux of the matter is that <em>we don&#8217;t care at all what the xml string is</em>.  What really matters is what we <strong>do</strong> with it, and in this case what we do is build the XML in one process, and reconstruct an equivalent data structure in another process.  We should test that the behaviour works, not the details of an intermediate structure.</p>
<p><code></p>
<pre>
@test public static void serializesAndRebuildsFoobars() {
  DataStructure structure = new DataStructure("foo", "bar");
  XmlSerializer s = new XmlSerializer();
  XmlParser p = new XmlParser();
  
  assertEquals(structure, p.parse(s.serialize(structure)));
}
</pre>
<p></code></p>
<p>Now this tests the behaviour we&#8217;re interested in.  Note that this test is robust, as changes of the intermediate representation will not break it.  We don&#8217;t really even care what the serialized data type is: we could change it to byte array, or anything else, with no need to change this test.</p>
<p>This sort of tests supports incremental development.  If my data structure was, for instance, a list, I could write a nice sequence of tests:</p>
<ul>
<li>serializesAndRebuildsEmptyLists</li>
<li>serializesAndRebuildsSingletonLists</li>
<li>serializesAndRebuildsListsOfManyElements</li>
<li>&#8230;</li>
</ul>
<p>One final note: let the pair who writes the serializer also write the parser.  This will save a lot of arguments :-)  Vertical slices of functionality always work best.</p>

				
				<p class="postmetadata alt">
					<small>
						This entry was posted
												on 15 June 2010 at 16:17						and is filed under <a href="category/agile.html" rel="category tag">Agile</a>.
						You can follow any responses to this entry through the <a href="407/feed">RSS 2.0</a> feed.

													You can <a href="#respond">leave a response</a>, or <a href="407/trackback" rel="trackback">trackback</a> from your own site.

						
					</small>
				</p>

			</div>
		</div>

	
<!-- You can start editing here. -->

	<h3 id="comments">5 Responses to &#8220;Test behaviour not syntax&#8221;</h3> 

	<ol class="commentlist">

	
		<li class="alt" id="comment-93274">
			<cite><a href='http://jfranzoi.wordpress.com/' rel='external nofollow' class='url'>jacopo</a></cite> Says:
						<br />

			<small class="commentmetadata"><a href="#comment-93274" title="">June 15th, 2010 at 22:21</a> </small>

			<p>well, if you&#8217;re lucky enough, both client and webservice will be under your control, so yes: focus on data (structure) sent/received, to be sure they&#8217;re as expected.</p>
<p>but is far more common a scenario where webservice aren&#8217;t under your control, they represent and integration point with external systems: that is, XML document syntax _is_ what you&#8217;re trying to test. for example, (I can think of at least 2 cases that happened to me in the last 6 months) switching from one parsing library to another or simply testing interoperabily (such as Java/.NET).</p>
<p>of course, not as much domain logic there ;) but still, webservices aren&#8217;t supposed to encapsulate domain knowledge, so focusing on syntax would be good enough.</p>

		</li>

	
	
		<li class="" id="comment-93276">
			<cite>matteo</cite> Says:
						<br />

			<small class="commentmetadata"><a href="#comment-93276" title="">June 16th, 2010 at 08:34</a> </small>

			<p>Hi Jacopo,</p>
<p>My answer got so long that I made a new post about it :-)</p>

		</li>

	
	
		<li class="alt" id="comment-93277">
			<cite><a href='411.html' rel='external nofollow' class='url'>Extreme Enthusiasm &raquo; Blog Archive &raquo; Answering Jacopo&#8217;s comment</a></cite> Says:
						<br />

			<small class="commentmetadata"><a href="#comment-93277" title="">June 16th, 2010 at 08:37</a> </small>

			<p>[&#8230;] &laquo; Test behaviour not syntax [&#8230;]</p>

		</li>

	
	
		<li class="" id="comment-93305">
			<cite><a href='http://www.francolombardo.net/' rel='external nofollow' class='url'>Franco Lombardo</a></cite> Says:
						<br />

			<small class="commentmetadata"><a href="#comment-93305" title="">June 22nd, 2010 at 08:06</a> </small>

			<p>Matteo,</p>
<p>this time I partially disagree with your point. Well, if it&#8217;s obviously a bad practice to test the raw XML string since, as you pointed out, it would create a really brittle test, I don&#8217;t feel comfortable with your solution.<br />
First of all, I entirely agree with Jacopo&#8217;s annotations. But what I would underline here is that you wrote what I call an &#8220;ever green test&#8221;. I mean that your test could be successful even when both XmlSerializer and XmlParser are wrong, if the mistakes in the two classes are symmetric. Think, for example, to the case of the broken XML prolog you showed: if both classes use a broken prolog, they will talk each other, but they will never talk to anyone else. Or you can think of both classes serializing and de-serializing decimal numbers using comma as a decimal separator, as in the Italian convention (I really did this mistake, so I&#8217;m pretty an expert ;-) ).<br />
You said that in your use case the two classes need to talk to each other and not to the rest of the world, so my annotations could be of no interest, anyway I think we need to take care of &#8220;ever green tests&#8221;.</p>

		</li>

	
	
		<li class="alt" id="comment-93308">
			<cite>matteo</cite> Says:
						<br />

			<small class="commentmetadata"><a href="#comment-93308" title="">June 22nd, 2010 at 15:50</a> </small>

			<p>Hi Franco,</p>
<p>thanks for your criticism!!  Yes, I see how that could be a problem.  The prolog problem I would fix by having the parser use an XML parser, so that invalid xml would cause an exception.  But I could get that also by testing the XML against XPath queries, as Jacopo suggests in the next post.</p>
<p>YMMV, but I still think it&#8217;s valuable to write code to extract the information from the xml and check this information.  The extraction code could be a separate class, or private testing methods inside the test class.  </p>
<p>I see how it would be valuable to *also* have a check that the syntax conforms to what I expect.  But that would be a *testing* test, not a TDD test.  I think that tests with serialize-then-parse would be better for driving the design.</p>

		</li>

	
	
	</ol>

 


<h3 id="respond">Leave a Reply</h3>


<form action="http://matteo.vaccari.name/blog/wp-comments-post.php" method="post" id="commentform">


<p><input type="text" name="author" id="author" value="" size="22" tabindex="1" />
<label for="author"><small>Name (required)</small></label></p>

<p><input type="text" name="email" id="email" value="" size="22" tabindex="2" />
<label for="email"><small>Mail (will not be published) (required)</small></label></p>

<p><input type="text" name="url" id="url" value="" size="22" tabindex="3" />
<label for="url"><small>Website</small></label></p>


<!--<p><small><strong>XHTML:</strong> You can use these tags: &lt;a href=&quot;&quot; title=&quot;&quot;&gt; &lt;abbr title=&quot;&quot;&gt; &lt;acronym title=&quot;&quot;&gt; &lt;b&gt; &lt;blockquote cite=&quot;&quot;&gt; &lt;cite&gt; &lt;code&gt; &lt;del datetime=&quot;&quot;&gt; &lt;em&gt; &lt;i&gt; &lt;q cite=&quot;&quot;&gt; &lt;s&gt; &lt;strike&gt; &lt;strong&gt; </small></p>-->

<p><textarea name="comment" id="comment" cols="100%" rows="10" tabindex="4"></textarea></p>

<p><input name="submit" type="submit" id="submit" tabindex="5" value="Submit Comment" />
<input type="hidden" name="comment_post_ID" value="407" />
</p>
<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="25da65843c" /></p><p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="226"/></p>
</form>



	
    </div>

    <div id='right-col'>
        <div id="sidebar">
    <ul>

      <li>
        <form method="get" id="searchform" action="http://matteo.vaccari.name/blog/">
  <div>
    <input tabindex="1" type="text" value="" name="s" id="s" />
    <input type="submit" id="searchsubmit" value="Search" />
  </div>
</form>
      </li>

      <li>

        <h2>About</h2>

	I am a software developer working with <a href="http://thoughtworks.com/">Thoughtworks Italia</a>.
        I'm a fan of <a
        href="http://extremeprogramming.org/">Extreme Programming</a>.
        I&nbsp;helped organize the <a
        href="http://essap.dicom.uninsubria.it/">European Summer School on
        Agile Programming</a>

      </li>

      <li>
            </li>

      <li class="pagenav"><h2>Pages</h2><ul><li class="page_item page-item-851"><a href="../selected-tdd-resources-to-start.html">Selected TDD Resources To Start</a></li>
<li class="page_item page-item-583"><a href="../tdd-resources.html">TDD Resources</a></li>
<li class="page_item page-item-247"><a href="../the-hexagonal-architecture.html">The Hexagonal Architecture</a></li>
</ul></li>

      
      <li><h2>Archives</h2>
        <ul>
        	<li><a href='date/2018/10.html'>October 2018</a></li>
	<li><a href='date/2017/09.html'>September 2017</a></li>
	<li><a href='date/2016/08.html'>August 2016</a></li>
	<li><a href='date/2016/03.html'>March 2016</a></li>
	<li><a href='date/2016/01.html'>January 2016</a></li>
	<li><a href='date/2014/12.html'>December 2014</a></li>
	<li><a href='date/2014/10.html'>October 2014</a></li>
	<li><a href='date/2014/06.html'>June 2014</a></li>
	<li><a href='date/2014/02.html'>February 2014</a></li>
	<li><a href='date/2013/12.html'>December 2013</a></li>
	<li><a href='date/2013/11.html'>November 2013</a></li>
	<li><a href='date/2013/06.html'>June 2013</a></li>
	<li><a href='date/2013/05.html'>May 2013</a></li>
	<li><a href='date/2013/03.html'>March 2013</a></li>
	<li><a href='date/2013/02.html'>February 2013</a></li>
	<li><a href='date/2012/10.html'>October 2012</a></li>
	<li><a href='date/2012/08.html'>August 2012</a></li>
	<li><a href='date/2012/07.html'>July 2012</a></li>
	<li><a href='date/2012/06.html'>June 2012</a></li>
	<li><a href='date/2012/05.html'>May 2012</a></li>
	<li><a href='date/2012/04.html'>April 2012</a></li>
	<li><a href='date/2012/01.html'>January 2012</a></li>
	<li><a href='date/2011/12.html'>December 2011</a></li>
	<li><a href='date/2011/11.html'>November 2011</a></li>
	<li><a href='date/2011/10.html'>October 2011</a></li>
	<li><a href='date/2011/07.html'>July 2011</a></li>
	<li><a href='date/2011/06.html'>June 2011</a></li>
	<li><a href='date/2011/05.html'>May 2011</a></li>
	<li><a href='date/2011/04.html'>April 2011</a></li>
	<li><a href='date/2011/03.html'>March 2011</a></li>
	<li><a href='date/2011/02.html'>February 2011</a></li>
	<li><a href='date/2010/11.html'>November 2010</a></li>
	<li><a href='date/2010/10.html'>October 2010</a></li>
	<li><a href='date/2010/09.html'>September 2010</a></li>
	<li><a href='date/2010/08.html'>August 2010</a></li>
	<li><a href='date/2010/07.html'>July 2010</a></li>
	<li><a href='date/2010/06.html'>June 2010</a></li>
	<li><a href='date/2010/05.html'>May 2010</a></li>
	<li><a href='date/2010/04.html'>April 2010</a></li>
	<li><a href='date/2010/03.html'>March 2010</a></li>
	<li><a href='date/2010/02.html'>February 2010</a></li>
	<li><a href='date/2010/01.html'>January 2010</a></li>
	<li><a href='date/2009/12.html'>December 2009</a></li>
	<li><a href='date/2009/11.html'>November 2009</a></li>
	<li><a href='date/2009/10.html'>October 2009</a></li>
	<li><a href='date/2009/09.html'>September 2009</a></li>
	<li><a href='date/2009/07.html'>July 2009</a></li>
	<li><a href='date/2009/05.html'>May 2009</a></li>
	<li><a href='date/2009/04.html'>April 2009</a></li>
	<li><a href='date/2009/03.html'>March 2009</a></li>
	<li><a href='date/2009/02.html'>February 2009</a></li>
	<li><a href='date/2009/01.html'>January 2009</a></li>
	<li><a href='date/2008/12.html'>December 2008</a></li>
	<li><a href='date/2008/11.html'>November 2008</a></li>
	<li><a href='date/2008/10.html'>October 2008</a></li>
	<li><a href='date/2008/09.html'>September 2008</a></li>
	<li><a href='date/2008/07.html'>July 2008</a></li>
	<li><a href='date/2008/06.html'>June 2008</a></li>
	<li><a href='date/2008/05.html'>May 2008</a></li>
	<li><a href='date/2008/04.html'>April 2008</a></li>
	<li><a href='date/2008/01.html'>January 2008</a></li>
	<li><a href='date/2007/11.html'>November 2007</a></li>
	<li><a href='date/2007/10.html'>October 2007</a></li>
	<li><a href='date/2007/09.html'>September 2007</a></li>
	<li><a href='date/2007/06.html'>June 2007</a></li>
	<li><a href='date/2007/05.html'>May 2007</a></li>
	<li><a href='date/2007/04.html'>April 2007</a></li>
	<li><a href='date/2007/03.html'>March 2007</a></li>
	<li><a href='date/2007/02.html'>February 2007</a></li>
	<li><a href='date/2007/01.html'>January 2007</a></li>
	<li><a href='date/2006/12.html'>December 2006</a></li>
	<li><a href='date/2006/11.html'>November 2006</a></li>
	<li><a href='date/2006/10.html'>October 2006</a></li>
	<li><a href='date/2006/09.html'>September 2006</a></li>
	<li><a href='date/2006/08.html'>August 2006</a></li>
	<li><a href='date/2006/07.html'>July 2006</a></li>
	<li><a href='date/2006/06.html'>June 2006</a></li>
	<li><a href='date/2006/05.html'>May 2006</a></li>
	<li><a href='date/2006/04.html'>April 2006</a></li>
	<li><a href='date/2006/03.html'>March 2006</a></li>
	<li><a href='date/2006/02.html'>February 2006</a></li>
	<li><a href='date/2006/01.html'>January 2006</a></li>
        </ul>
      </li>

      <li><h2>Categories</h2>
        <ul>
        	<li class="cat-item cat-item-1"><a href="category/agile.html" >Agile</a> (229)
</li>
	<li class="cat-item cat-item-3"><a href="category/books.html" >Books</a> (2)
</li>
	<li class="cat-item cat-item-11"><a href="category/design-exercise.html" >Design Exercise</a> (5)
</li>
	<li class="cat-item cat-item-6"><a href="category/essay.html" >Essay</a> (13)
</li>
	<li class="cat-item cat-item-8"><a href="category/expressive-code.html" >Expressive Code</a> (11)
</li>
	<li class="cat-item cat-item-10"><a href="category/fundamentals.html" >Fundamentals</a> (6)
</li>
	<li class="cat-item cat-item-9"><a href="category/other.html" >other</a> (1)
</li>
        </ul>
      </li>

      
    </ul>
  </div>

    </div>
</div>


<hr />
<div id="footer">
<address>
  <script type="text/javascript">eval(unescape('%64%6f%63%75%6d%65%6e%74%2e%77%72%69%74%65%28%27%3c%61%20%68%72%65%66%3d%22%6d%61%69%6c%74%6f%3a%76%61%63%63%61%72%69%40%70%6f%62%6f%78%2e%63%6f%6d%22%3e%76%61%63%63%61%72%69%40%70%6f%62%6f%78%2e%63%6f%6d%3c%2f%61%3e%27%29%3b'))</script>
</address>
</div>
</div>
  <script type='text/javascript' src='../wp-includes/js/wp-embed.min3c21.js?ver=5.1.1'></script>
<script async="async" type='text/javascript' src='../wp-content/plugins/akismet/_inc/form0235.js?ver=4.1.1'></script>
</body>

<!-- Mirrored from matteo.vaccari.name/blog/archives/407 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 24 Sep 2021 10:26:43 GMT -->
</html>
