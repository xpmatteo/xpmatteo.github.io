<!DOCTYPE html>
<html>


<!-- Mirrored from matteo.vaccari.name/blog/archives/date/2006/09 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 24 Sep 2021 10:21:24 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="initial-scale=1">

<title>Extreme Enthusiasm   &raquo; 2006 &raquo; September</title>

<meta name="generator" content="WordPress 5.1.1" /> <!-- leave this for stats -->

<link rel="stylesheet" href="../../../wp-content/themes/mv2/style.css" type="text/css" media="screen" />
<link rel="alternate" type="application/rss+xml" title="Extreme Enthusiasm RSS Feed" href="../../../feed" />
<link rel="pingback" href="../../../xmlrpc.php" />

<link rel='dns-prefetch' href='http://s.w.org/' />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11.2.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11.2.0\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/matteo.vaccari.name\/blog\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.1.1"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='wp-block-library-css'  href='../../../wp-includes/css/dist/block-library/style.min3c21.css?ver=5.1.1' type='text/css' media='all' />
<link rel='https://api.w.org/' href='../../../wp-json/index.html' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../../xmlrpc0db0.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../../../wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.1.1" />
</head>
<body>
<div id="page">

<div id="header">
	<h1><a href="../../../../blog">Extreme Enthusiasm</a></h1>
</div>

<div id='maincontent'>
  <div id='main-col'>

		
				<h2 class="pagetitle">Archive for September, 2006</h2>

		
		<div class="navigation">
			<div class="alignleft"></div>
			<div class="alignright"></div>
		</div>

				<div class="post">
				<h3 id="post-45"><a href="../../45.html" rel="bookmark" title="Permanent Link to Pirati del piffero">Pirati del piffero</a></h3>
				<small>Wednesday, September 27th, 2006</small>

				<div class="entry">
					<p><em>Summary: &#8220;Pirates of the Caribbean: Dead Man&#8217;s Chest&#8221; sucks.<br />
</em></p>
<p>Ho visto &#8220;I pirati dei Caraibi&#8221;.  Due ore e mezzo in cui praticamente non succede nulla, e il finale in sospeso per aspettare il terzo episodio.  I personaggi, che erano così fighi nel primo film, vengono diluiti, sprecati, buttati via.  Mi sembra molto scarso, anche per la media dei seguiti.</p>
				</div>

				<p class="postmetadata">Posted in <a href="../../category/agile.html" rel="category tag">Agile</a> |   <a href="../../45.html#comments">3 Comments &#187;</a></p>
		</div>

				<div class="post">
				<h3 id="post-44"><a href="../../44.html" rel="bookmark" title="Permanent Link to Misc Rails news">Misc Rails news</a></h3>
				<small>Sunday, September 17th, 2006</small>

				<div class="entry">
					<p>Summary: a few new neat things in the Rails world.  Keep rocking!</p>
<p>E&#8217; appena finita la conferenza europea, e DHH ha già  <a href='http://www.loudthinking.com/arc/000599.html'>bloggato sulle novità</a>.  Un mio cliente è stato là, e non vedo l&#8217;ora di strappargli tutto quello che ha imparato&#8230; (c:</p>
<p>DHH continua sulla sua strada di radicale semplificazione attraverso <a href='http://www.ics.uci.edu/~fielding/pubs/dissertation/top.htm'>REST</a>, come aveva già <a href="http://blog.scribestudio.com/articles/2006/07/09/david-heinemeier-hansson-railsconf-2006-keynote-address">mostrato</a> alla conferenza americana.  Ora però c&#8217;è <a href="http://www.matthewman.net/articles/2006/09/04/new-rails-feature-simply_helpful">Simply Helpful</a>, un nuovo stile per le view.  Ho la sensazione che dovremo aspettare un bel pezzo per la seconda edizione di Agile Web Development, dato che DHH continua a riscrivere Rails.  Ma non mi lamento: sono tutte modifiche che vanno nella direzione di semplificare la vita per le cose che si fanno più di frequente!  Non di aggiungere a Rails ogni immaginabile cazzillo.</p>
<p><strong>Capistrano</strong> è stato aggiornato, una novità è una <a href='http://www.ryandaigle.com/articles/2006/09/11/whats-new-in-edge-rails-an-interactive-capistrano-shell'>shell interattiva</a> che ti permette di manipolare interattivamente un insieme di server.</p>
<p>Da un po&#8217; di tempo si sente parlare di Unobtrusive JavaScript; l&#8217;idea è che non è bello vedere codice JS inframmezzato un po&#8217; a casaccio in mezzo all'(X)HTML.  Molto meglio confinare il JS in un singolo file caricato separatamente.  E&#8217; possibile in tale file attaccare comportamenti ai vari elementi della pagina tramite codice che se ne sta comunque confinato nel suo file.  Per lo meno questo è il tipo di approccio preferito dagli <a href='http://alistapart.com/'>assi</a> del web design.  Ora c&#8217;è un <a href='http://www.ujs4rails.com/resources/quickstart-guide'>plugin per Rails</a> che serve a fare proprio questo.</p>
<p><a href="http://unspace.ca/discover/haml">HAML</a> è un nuovo linguaggio di templating per Rails; mentre il linguaggio originale di Rails (RHTML) è semplice e un po&#8217; troppo casereccio per i gusti degli sviluppatori più sofisticati, HAML è, appunto, molto più elegante e sofisticato.</p>
<p>E non ultimo, l&#8217;esplosivo <a href="http://blog.scribestudio.com/articles/2006/07/09/david-heinemeier-hansson-railsconf-2006-keynote-address">Why The Lucky Stiff</a> (autore fra l&#8217;altro di una versione semplificata di Rails che permette di scrivere un&#8217;intera web app in un solo file Ruby) ha parlato di <a href="https://code.whytheluckystiff.net/sandbox/wiki/InstallingTheSandbox">Sandbox</a>, un meccanismo per condividere molte applicazioni Rails su un solo processo di web server (Mongrel, per la precisione).  E questa è musica per le mie orecchie&#8230; manutenere il server per le applicazioni degli studenti è improvvisamente diventato più facile.  </p>
<p>All this coolness, so little time.</p>
				</div>

				<p class="postmetadata">Posted in <a href="../../category/agile.html" rel="category tag">Agile</a> |   <a href="../../44.html#respond">No Comments &#187;</a></p>
		</div>

				<div class="post">
				<h3 id="post-43"><a href="../../43.html" rel="bookmark" title="Permanent Link to Sudoku anch&#8217;io">Sudoku anch&#8217;io</a></h3>
				<small>Friday, September 1st, 2006</small>

				<div class="entry">
					<p><em>Summary: last meeting of the Milano XP UG was about TTDing a program to solve Sudoku games.  Pretty good fun.<br />
</em></p>
<p>Non ho mai avuto la pazienza per risolvere i sudoku.  Essendo pigro, scriverò un programma per risolverli&#8230;</p>
<p>L&#8217;ultimo meeting del Milano XP User Group ha avuto come tema &#8220;risolviamo il Sudoku con TDD&#8221;.  Il problema è: dato un sudoku, scrivi un programma che per ogni cella mi dice quali sono i numeri che posso legalmente scriverci dentro.  </p>
<h3>Numeri proibiti</h3>
<p>In coppia con l&#8217;ottimo Roberto Valenti abbiamo affrontato il problema in Ruby.  Abbiamo cominciato decidendo arbitrariamente di rappresentare il tabellone con un singolo array di interi.  E&#8217; la rappresentazione più semplice, e fino a quando non risulterà inadeguata non c&#8217;è bisogno di usarne una più complicata.  YAGNI!</p>
<pre>
TEST_BOARD = [
  0,   1,  2,  3,  4,  5,  6,  7,  8, 
  9,  10, 11, 12, 13, 14, 15, 16, 17, 
  18, 19, 20, 21, 22, 23, 24, 25, 26, 
  27, 28, 29, 30, 31, 32, 33, 34, 35, 
  36, 37, 38, 39, 40, 41, 42, 43, 44, 
  45, 46, 47, 48, 49, 50, 51, 52, 53, 
  54, 55, 56, 57, 58, 59, 60, 61, 62, 
  63, 64, 65, 66, 67, 68, 69, 70, 71, 
  72, 73, 74, 75, 76, 77, 78, 79, 80, 
]
</pre>
<p>(Questa tabella di test è stata generata con un semplice programma.)</p>
<p>Da qualche parte bisogna iniziare.  Abbiamo deciso di iniziare sviluppando metodi per estrarre righe, colonne e quadranti dalla tabella. </p>
<pre>
def test_row_col
  assert_equal [18, 19, 20, 21, 22, 23, 24, 25, 26], row(TEST_BOARD, 2)
  assert_equal [1, 10, 19, 28, 37, 46, 55, 64, 73],  col(TEST_BOARD, 1)
  assert_equal [27, 28, 29, 36, 37, 38, 45, 46, 47], quad(TEST_BOARD, 4, 1)
end
</pre>
<p>Da notare solo che quad(board, r, c) restituisce il quadrante dentro cui cade r, c.  Quindi quad(board, 0, 0) sarà uguale a quad(board, 2, 2) perché entrambi restituiscono il primo quadrante.</p>
<p>A questo punto il problema è già quasi risolto.  È più facile ottenere prima i numeri proibiti.  Prima di tutto, se il tabellone è tutto vuoto, non ci sono vincoli.</p>
<pre>
# rappresentiamo le caselle vuote con 0
EMPTY_BOARD = Array.new(81, 0)
def test_forbidden_numbers_on_empty_board
  assert_equal [], forbidden_numbers(EMPTY_BOARD, 4, 4)
end
</pre>
<p>e la soluzione è facile:</p>
<pre>
def forbidden_numbers(board, r, c)
  []
end
</pre>
<p>Poi testiamo che vengano considerati proibiti i numeri che appaiono nel quadrante.  Inputiamo un sudoku diagonale giusto per testare questo:</p>
<pre>
DIAG_BOARD = [
  1,0,0,0,0,0,0,0,0,
  0,2,0,0,0,0,0,0,0,
  0,0,3,0,0,0,0,0,0,
  0,0,0,4,0,0,0,0,0,
  0,0,0,0,5,0,0,0,0,
  0,0,0,0,0,6,0,0,0,
  0,0,0,0,0,0,7,0,0,
  0,0,0,0,0,0,0,8,0,
  0,0,0,0,0,0,0,0,9,
]
def test_forbidden_numbers_on_quadrant
  assert_equal [1,2,3], forbidden_numbers(DIAG_BOARD, 0, 1)
  assert_equal [7,8,9], forbidden_numbers(DIAG_BOARD, 8, 7)
end
</pre>
<p>e modifichiamo di conseguenza la funzione</p>
<pre>
def forbidden_numbers(board, r, c)
  quad(board, r, c).reject {|x| 0 == x}
end
</pre>
<p>Ora vogliamo tenere conto anche dei numeri che stanno sulle colonne </p>
<pre>
def test_forbidden_numbers_on_columns
  assert_equal [1], forbidden_numbers(DIAG_BOARD, 8, 0)
  assert_equal [6], forbidden_numbers(DIAG_BOARD, 0, 5)
end 
</pre>
<p>E fin qui è facile</p>
<pre>
def forbidden_numbers(board, r, c)
  result = quad(board, r, c) + col(board, c)
  result.reject {|x| 0 == x}
end
</pre>
<p>E così via per le righe</p>
<pre>
def forbidden_numbers(board, r, c)
  result = quad(board, r, c) + col(board, c) + row(board, r)
  result.reject {|x| 0 == x}
end
</pre>
<p>Ora, è facile prevedere problemi nel caso in cui il tabellone non è una diagonale: rischiamo di avere numeri duplicati, e comunque non nell&#8217;ordine crescente che i nostri test si aspettano.  Scriviamo un test che espone un problema, e lo risolviamo in stile Unix, con sort e uniq</p>
<pre>
def forbidden_numbers(board, r, c)
  result = quad(board, r, c) + col(board, c) + row(board, r)
  result = result.reject {|x| 0 == x}
  result.sort
  result.uniq
end
</pre>
<p>I numeri permessi, a questo punto, sono semplicemente il complemento di quelli proibiti.  </p>
<pre>
def possible_numbers(board, r, c)
  complement(forbidden_numbers(board, r, c))
end

def complement(ar)
  universe = [1,2,3,4,5,6,7,8,9]
  universe.reject {|x| ar.member?(x) }
end  
</pre>
<h3>Espiazione</h3>
<p>Avrai notato che fino ad ora abbiamo lavorato in maniera molto poco object-oriented.  Poco male!  Il punto è risolvere il problema nella maniera più semplice possibile.  Però a questo punto il nostro codice comincia ad avere parecchie &#8220;funzioni&#8221; che se ne stanno appese nel vuoto.  E non mi piace il fatto che in parecchi punti dobbiamo convertire le coordinate &#8220;lineari&#8221; della nostra lista in coordinate quadrate (r,c).  </p>
<p>Decidiamo di rifattorizzare il codice per nascondere l&#8217;implementazione della tabella.  Creiamo una classe Board inizializzata da un array</p>
<pre>
class Board
  def initialize(list)
    @list = list.dup
  end
end
</pre>
<p>e passiamo 10 minuti a convertire tutti i nostri test, spostando dentro alla classe i metodi che prima fluttuavano nel vuoto.  Sempre però un test alla volta, spostando solo i metodi necessari, e sempre rieseguendo i test.  Alla fine abbiamo questi test</p>
<pre>
class TestNameOfTestCases &lt; Test::Unit::TestCase  
  def test_board_at
    b = Board.new(SOLVED_BOARD)
    assert_equal b.at(0, 0), 8
    assert_equal b.at(2, 3), 1
  end

  def test_set
    b = Board.new(SOLVED_BOARD)
    b.set(2,3,255)
    assert_equal 255, b.at(2, 3)
  end
  
  def test_board_find_hole
    b = Board.new(SOLVED_BOARD)
    assert_equal nil, b.find_hole
    b.set(1, 2, 0)
    assert_equal [1, 2], b.find_hole
  end

  def test_row_col
    b = Board.new(TEST_BOARD)
    assert_equal [18, 19, 20, 21, 22, 23, 24, 25, 26], b.row(2)
    assert_equal [1, 10, 19, 28, 37, 46, 55, 64, 73],  b.col(1)
    assert_equal [0, 1, 2, 9, 10, 11, 18, 19, 20], b.quad(0, 0)
    assert_equal [0, 1, 2, 9, 10, 11, 18, 19, 20], b.quad(1, 1)
    assert_equal [0, 1, 2, 9, 10, 11, 18, 19, 20], b.quad(2, 2)
    assert_equal [27, 28, 29, 36, 37, 38, 45, 46, 47], b.quad(4, 1)
    assert_equal [30, 31, 32, 39, 40, 41, 48, 49, 50], b.quad(5, 5)
  end
  
  def test_forbidden_numbers_on_quadrant
    assert_equal [], Board.new(EMPTY_BOARD).forbidden_numbers(4, 4)
    assert_equal [1,2,3], Board.new(DIAG_BOARD).forbidden_numbers(0, 1)
  end
  
  def test_forbidden_numbers_on_quad_and_row
    b = Board.new(DIAG_BOARD)
    b.set(0, 4, 4)
    assert_equal [1,2,3,4], b.forbidden_numbers(0, 1)
  end

  def test_forbidden_numbers_on_quad_and_col
    b = Board.new(DIAG_BOARD)
    b.set(4, 0, 5)
    assert_equal [1,2,3,5], b.forbidden_numbers(1, 0)
  end
  
  def test_possible_numbers_on_problem
    b = Board.new(PROBLEM)
    assert_equal [3], b.possible_numbers(0, 1)
  end

  def test_complement
    assert_equal [], Board.complement([1,2,3,4,5,6,7,8,9])
    assert_equal [9], Board.complement([1,2,3,4,5,6,7,8])
    assert_equal [1,4,9], Board.complement([2,3,5,6,7,8])
  end
</pre>
<p>e questo codice </p>
<pre>

class Board
  def initialize(list=nil)
    @list = list.dup
  end
  
  def at(r, c)
    @list[r*9 + c] 
  end
  
  def set(r, c, val)
    @list[r*9 + c] = val
  end

  def forbidden_numbers(r, c)
    result = quad(r, c)
    result += row(r)
    result += col(c)
    result = result.reject { |n| n == 0 }
    result.sort
    result.uniq
  end

  def possible_numbers(r, c)
    Board.complement(forbidden_numbers(r, c))
  end

  def self.complement(ar)
    universe = [1,2,3,4,5,6,7,8,9]
    universe.reject {|x| ar.member?(x) }
  end

  def quad(r, c)
    result = []
    for rr in ((r/3)*3...(r/3)*3+3)
      for cc in ((c/3)*3...(c/3)*3+3)
        result << at(rr, cc)
      end
    end
    result
  end
  
  def row(n)
    @list[n*9...(n+1)*9]
  end

  def col(c)
    (0...9).map {|r| at(r, c)}
  end
  
  def list
    @list
  end
  
private
  def linear_to_r_c(index)
    [index / 9, index % 9]
  end
end
</pre>
<p>Facciamo un test di accettazione: prendiamo un sudoku risolto, e a turno cancelliamo un elemento.  La funzione possible_numbers deve restituire il numero appena tolto.</p>
<pre>
  def test_solved_board
    b = Board.new(SOLVED_BOARD)
    for r in (0...9)
      for c in (0...9)
        element = b.at(r, c)
        b.set(r, c, 0)
        assert_equal [element], b.possible_numbers(r, c)
        b.set(r, c, element)
      end
    end
  end  
</pre>
<p>Funziona!  E' vero che potremmo fare dei test più accurati, ma sono abbastanza confidente che la nostra soluzione sia corretta.  Comunque, se non fossimo al pub alle 8 di sera probabilmente mi metterei il berretto da tester e farei qualche test in più.</p>
<h3>Una volta si chiamava A.I.</h3>
<p>Avevamo ancora un filo di energia, così abbiamo deciso di continuare scrivendo un metodo solve(board) che restituisca un sudoku completato.</p>
<p>In generale, questo tipo di problemi si risolvono per mezzo di <em>ricerca</em>.  Ovvero, non c'è un algoritmo che mi possa dire in un colpo solo qual'è il numero da mettere.  Quasi tutti i puzzle ricadono in questo schema: il problema delle N regine, il problema del 15, il cubo di Rubik...</p>
<p>Abbiamo uno stato iniziale; per ogni stato abbiamo un certo numero di mosse a disposizione.  Risulta un albero di stati.  Le foglie di questo albero sono stati in cui il gioco è risolto (yuppi!), oppure stati in cui il gioco non è risolto e non ci sono altre mosse possibili (buuu).</p>
<p>Il problema allora è esplorare l'albero degli stati in maniera da trovare il prima possibile un nodo-soluzione.  Ci sono due strategie di base, che si applicano a tutti i puzzle.  La strategia <strong>breadth-first</strong>: partendo dalla radice, considero tutti i nodi raggiungibili.  Ho trovato la soluzione?  Se no, per ogni nodo trovato, considero tutti i suoi nodi raggiungibili. Cioè, esamino tutti i nodi di livello 2.  Vado avanti così, esaminando tutti i nodi di livello <em>n</em> fino a che non trovo una soluzione.</p>
<p>Il vantaggio del breadth-first è che trova di sicuro la soluzione più breve.  Lo svantaggio è che rischio di metterci moltissimo tempo a trovarla.</p>
<p>L'altra strategia agnostica è <strong>depth-first</strong>: dalla radice scelgo la prima mossa, poi la prima mossa, e sempre la prima mossa fino a quando non raggiungo una foglia.  Se è un fallimento, torno indietro di *un* passo e esamino la seconda mossa.  Se esaurisco tutte le mosse possibili a quel livello, torno indietro di un altro passo e considero la seconda mossa da lì.</p>
<p>Lo svantaggio del depth-first è che non è garantito che possa mai trovare una soluzione.  Nel caso del sudoku, però, questo non è un problema perché la profondità dell'albero è sempre limitata dal numero di caselle vuote da riempire.   </p>
<p>E' facile implementare una ricerca depth-first, usando una funzione ricorsiva.</p>
<pre>
def solve(prob)
  return prob if prob.solved?
  for move in prob.possible_moves
    try = solve(prob.apply(move))
    # if solved, stop here
    return try if try
  end
  # no more moves
  return false
end
</pre>
<p>Lo stack implicito nella valutazione della funzione ricorsiva mi tiene traccia di a che punto sono nella mia esplorazione dell'albero.</p>
<h3>Risolviamo un gioco completo</h3>
<p>Con questo schema in mente, scriviamo il nostro primo test.  Se il problema è risolto, deve restituire la tabella risolta</p>
<pre>
def test_solve
  assert_equal SOLVED_BOARD, solve(Board.new(SOLVED_BOARD))
end
</pre>
<p>E fin qui è facile.  Poi proviamo a togliere una posizione dal gioco completato, e ci aspettiamo che ritrovi di nuovo la soluzione</p>
<pre>
def test_solve
  b = Board.new(SOLVED_BOARD)
  assert_equal SOLVED_BOARD, solve(b)

  b.set(0,0,0) # metto 0 alla posizione 0,0
  assert_equal SOLVED_BOARD, solve(b)
end  
</pre>
<p>Anche questo si risolve facilmente.  Ci serve una funzione che trovi il primo "buco".  Se il buco non c'è, assumiamo che il gioco sia risolto</p>
<pre>
class Board
  def find_hole
    @list.each_with_index { |e, index|
      return linear_to_r_c(index) if e == 0
    }
    nil
  end
end

def solve(board)
  if !board.find_hole 
    return board.list
  end
  r, c = board.find_hole
  possibles = board.possible_numbers(r, c)
  board.set(r, c, possibles.first)
end
</pre>
<p>Questo però assume che ci sia per forza un numero possibile.  Cosa succede se siamo a un nodo di fallimento?  Lo simuliamo passandogli un sudoku irrisolvibile</p>
<pre>
def test_failure_node
  b = Board.new(SOLVED_BOARD)
  b.set(0, 1, 8 )  # mossa non valida! ma non importa
  b.set(0, 0, 0)   # questo buco ora è irrisolvibile
  assert_equal false, solve(b)
end

def solve(board)
  if !board.find_hole 
    return board.list
  end
  r, c = board.find_hole
  possibles = board.possible_numbers(r, c)
  return false if !possibles
  board.set(r, c, possibles.first)
end
</pre>
<p>A questo punto facciamo emergere la nostra soluzione presentando problemi sempre più difficili.  In realtà essendo un po' stufi abbiamo preso una scorciatoia: abbiamo preso un problema da risolvere completo, e abbiamo implementato direttamente la soluzione ricorsiva.  Con qualche calcio l'abbiamo fatta funzionare:</p>
<pre>
PROBLEM = [
  1, 0, 2, 0, 0, 0, 7, 0, 0,
  0, 4, 7, 0, 2, 1, 3, 0, 0,
  0, 8, 0, 7, 0, 3, 0, 1, 0,
  4, 6, 0, 1, 0, 0, 0, 8, 0,
  0, 0, 0, 2, 6, 4, 0, 0, 0,
  0, 5, 0, 0, 0, 9, 0, 6, 4,
  0, 9, 0, 5, 0, 7, 0, 2, 0,
  0, 0, 1, 3, 4, 0, 9, 7, 0,
  0, 0, 6, 0, 0, 0, 8, 0, 3,
]
def test_solution
  sol = sove(PROBLEM)
  assert sol, "non ha risolto il problema :-("
  do_print sol
end  

def solve(board)
  if !board.find_hole 
    return board.list
  end
  r, c = board.find_hole
  possibles = board.possible_numbers(r, c)
  for p in possibles
    board.set(r, c, p)
    solved = solve(Board.new(board.list))
    return solved if solved
  end
  return false
end
</pre>
<p>Questo problema viene risolto in 0.2 secondi sul mio Mac G4.  Un problema più difficile, a livello <em>evil</em> da www.websudoku.com, viene risolto in 10 secondi.  Sono molto soddisfatto.</p>
<p>Penso che la performance si possa migliorare nettamente, per il caso difficile, modificando semplicemente il metodo find_hole.  Se invece di restituire il primo buco restituisse il buco che è maggiormente vincolato, immagino che taglieremmo di molto il numero di tentativi falliti.  E questo, caro lettore, resta come esercizio...</p>
				</div>

				<p class="postmetadata">Posted in <a href="../../category/agile.html" rel="category tag">Agile</a> |   <a href="../../43.html#comments">4 Comments &#187;</a></p>
		</div>

		
		<div class="navigation">
			<div class="alignleft"></div>
			<div class="alignright"></div>
		</div>

	  	</div>

  <div id='right-col'>
        <div id="sidebar">
    <ul>

      <li>
        <form method="get" id="searchform" action="http://matteo.vaccari.name/blog/">
  <div>
    <input tabindex="1" type="text" value="" name="s" id="s" />
    <input type="submit" id="searchsubmit" value="Search" />
  </div>
</form>
      </li>

      <li>

        <h2>About</h2>

	I am a software developer working with <a href="http://thoughtworks.com/">Thoughtworks Italia</a>.
        I'm a fan of <a
        href="http://extremeprogramming.org/">Extreme Programming</a>.
        I&nbsp;helped organize the <a
        href="http://essap.dicom.uninsubria.it/">European Summer School on
        Agile Programming</a>

      </li>

      <li>
            <p>You are currently browsing the <a href="../../../index.html">Extreme Enthusiasm</a> weblog archives
      for September, 2006.</p>

            </li>

      <li class="pagenav"><h2>Pages</h2><ul><li class="page_item page-item-851"><a href="../../../selected-tdd-resources-to-start.html">Selected TDD Resources To Start</a></li>
<li class="page_item page-item-583"><a href="../../../tdd-resources.html">TDD Resources</a></li>
<li class="page_item page-item-247"><a href="../../../the-hexagonal-architecture.html">The Hexagonal Architecture</a></li>
</ul></li>

      
      <li><h2>Archives</h2>
        <ul>
        	<li><a href='../2018/10.html'>October 2018</a></li>
	<li><a href='../2017/09.html'>September 2017</a></li>
	<li><a href='../2016/08.html'>August 2016</a></li>
	<li><a href='../2016/03.html'>March 2016</a></li>
	<li><a href='../2016/01.html'>January 2016</a></li>
	<li><a href='../2014/12.html'>December 2014</a></li>
	<li><a href='../2014/10.html'>October 2014</a></li>
	<li><a href='../2014/06.html'>June 2014</a></li>
	<li><a href='../2014/02.html'>February 2014</a></li>
	<li><a href='../2013/12.html'>December 2013</a></li>
	<li><a href='../2013/11.html'>November 2013</a></li>
	<li><a href='../2013/06.html'>June 2013</a></li>
	<li><a href='../2013/05.html'>May 2013</a></li>
	<li><a href='../2013/03.html'>March 2013</a></li>
	<li><a href='../2013/02.html'>February 2013</a></li>
	<li><a href='../2012/10.html'>October 2012</a></li>
	<li><a href='../2012/08.html'>August 2012</a></li>
	<li><a href='../2012/07.html'>July 2012</a></li>
	<li><a href='../2012/06.html'>June 2012</a></li>
	<li><a href='../2012/05.html'>May 2012</a></li>
	<li><a href='../2012/04.html'>April 2012</a></li>
	<li><a href='../2012/01.html'>January 2012</a></li>
	<li><a href='../2011/12.html'>December 2011</a></li>
	<li><a href='../2011/11.html'>November 2011</a></li>
	<li><a href='../2011/10.html'>October 2011</a></li>
	<li><a href='../2011/07.html'>July 2011</a></li>
	<li><a href='../2011/06.html'>June 2011</a></li>
	<li><a href='../2011/05.html'>May 2011</a></li>
	<li><a href='../2011/04.html'>April 2011</a></li>
	<li><a href='../2011/03.html'>March 2011</a></li>
	<li><a href='../2011/02.html'>February 2011</a></li>
	<li><a href='../2010/11.html'>November 2010</a></li>
	<li><a href='../2010/10.html'>October 2010</a></li>
	<li><a href='../2010/09.html'>September 2010</a></li>
	<li><a href='../2010/08.html'>August 2010</a></li>
	<li><a href='../2010/07.html'>July 2010</a></li>
	<li><a href='../2010/06.html'>June 2010</a></li>
	<li><a href='../2010/05.html'>May 2010</a></li>
	<li><a href='../2010/04.html'>April 2010</a></li>
	<li><a href='../2010/03.html'>March 2010</a></li>
	<li><a href='../2010/02.html'>February 2010</a></li>
	<li><a href='../2010/01.html'>January 2010</a></li>
	<li><a href='../2009/12.html'>December 2009</a></li>
	<li><a href='../2009/11.html'>November 2009</a></li>
	<li><a href='../2009/10.html'>October 2009</a></li>
	<li><a href='../2009/09.html'>September 2009</a></li>
	<li><a href='../2009/07.html'>July 2009</a></li>
	<li><a href='../2009/05.html'>May 2009</a></li>
	<li><a href='../2009/04.html'>April 2009</a></li>
	<li><a href='../2009/03.html'>March 2009</a></li>
	<li><a href='../2009/02.html'>February 2009</a></li>
	<li><a href='../2009/01.html'>January 2009</a></li>
	<li><a href='../2008/12.html'>December 2008</a></li>
	<li><a href='../2008/11.html'>November 2008</a></li>
	<li><a href='../2008/10.html'>October 2008</a></li>
	<li><a href='../2008/09.html'>September 2008</a></li>
	<li><a href='../2008/07.html'>July 2008</a></li>
	<li><a href='../2008/06.html'>June 2008</a></li>
	<li><a href='../2008/05.html'>May 2008</a></li>
	<li><a href='../2008/04.html'>April 2008</a></li>
	<li><a href='../2008/01.html'>January 2008</a></li>
	<li><a href='../2007/11.html'>November 2007</a></li>
	<li><a href='../2007/10.html'>October 2007</a></li>
	<li><a href='../2007/09.html'>September 2007</a></li>
	<li><a href='../2007/06.html'>June 2007</a></li>
	<li><a href='../2007/05.html'>May 2007</a></li>
	<li><a href='../2007/04.html'>April 2007</a></li>
	<li><a href='../2007/03.html'>March 2007</a></li>
	<li><a href='../2007/02.html'>February 2007</a></li>
	<li><a href='../2007/01.html'>January 2007</a></li>
	<li><a href='12.html'>December 2006</a></li>
	<li><a href='11.html'>November 2006</a></li>
	<li><a href='10.html'>October 2006</a></li>
	<li><a href='09.html'>September 2006</a></li>
	<li><a href='08.html'>August 2006</a></li>
	<li><a href='07.html'>July 2006</a></li>
	<li><a href='06.html'>June 2006</a></li>
	<li><a href='05.html'>May 2006</a></li>
	<li><a href='04.html'>April 2006</a></li>
	<li><a href='03.html'>March 2006</a></li>
	<li><a href='02.html'>February 2006</a></li>
	<li><a href='01.html'>January 2006</a></li>
        </ul>
      </li>

      <li><h2>Categories</h2>
        <ul>
        	<li class="cat-item cat-item-1"><a href="../../category/agile.html" >Agile</a> (229)
</li>
	<li class="cat-item cat-item-3"><a href="../../category/books.html" >Books</a> (2)
</li>
	<li class="cat-item cat-item-11"><a href="../../category/design-exercise.html" >Design Exercise</a> (5)
</li>
	<li class="cat-item cat-item-6"><a href="../../category/essay.html" >Essay</a> (13)
</li>
	<li class="cat-item cat-item-8"><a href="../../category/expressive-code.html" >Expressive Code</a> (11)
</li>
	<li class="cat-item cat-item-10"><a href="../../category/fundamentals.html" >Fundamentals</a> (6)
</li>
	<li class="cat-item cat-item-9"><a href="../../category/other.html" >other</a> (1)
</li>
        </ul>
      </li>

      
    </ul>
  </div>

    </div>
  </div>
</div>


<hr />
<div id="footer">
<address>
  <script type="text/javascript">eval(unescape('%64%6f%63%75%6d%65%6e%74%2e%77%72%69%74%65%28%27%3c%61%20%68%72%65%66%3d%22%6d%61%69%6c%74%6f%3a%76%61%63%63%61%72%69%40%70%6f%62%6f%78%2e%63%6f%6d%22%3e%76%61%63%63%61%72%69%40%70%6f%62%6f%78%2e%63%6f%6d%3c%2f%61%3e%27%29%3b'))</script>
</address>
</div>
</div>
  <script type='text/javascript' src='../../../wp-includes/js/wp-embed.min3c21.js?ver=5.1.1'></script>
</body>

<!-- Mirrored from matteo.vaccari.name/blog/archives/date/2006/09 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 24 Sep 2021 10:21:24 GMT -->
</html>
