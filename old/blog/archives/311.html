<!DOCTYPE html>
<html>


<!-- Mirrored from matteo.vaccari.name/blog/archives/311 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 24 Sep 2021 10:24:49 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="initial-scale=1">

<title>Extreme Enthusiasm  &raquo; Blog Archive   &raquo; Report of the first run of the OCP kata </title>

<meta name="generator" content="WordPress 5.1.1" /> <!-- leave this for stats -->

<link rel="stylesheet" href="../wp-content/themes/mv2/style.css" type="text/css" media="screen" />
<link rel="alternate" type="application/rss+xml" title="Extreme Enthusiasm RSS Feed" href="../feed" />
<link rel="pingback" href="../xmlrpc.php" />

<link rel='dns-prefetch' href='http://s.w.org/' />
<link rel="alternate" type="application/rss+xml" title="Extreme Enthusiasm &raquo; Report of the first run of the OCP kata Comments Feed" href="311/feed" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11.2.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11.2.0\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/matteo.vaccari.name\/blog\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.1.1"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='wp-block-library-css'  href='../wp-includes/css/dist/block-library/style.min3c21.css?ver=5.1.1' type='text/css' media='all' />
<link rel='https://api.w.org/' href='../wp-json/index.html' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../xmlrpc0db0.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Niente Shore né Larsen' href='309.html' />
<link rel='next' title='Next speaking engagements' href='325.html' />
<meta name="generator" content="WordPress 5.1.1" />
<link rel="canonical" href="311.html" />
<link rel='shortlink' href='../index2e31.html?p=311' />
<link rel="alternate" type="application/json+oembed" href="../wp-json/oembed/1.0/embedef98.json?url=http%3A%2F%2Fmatteo.vaccari.name%2Fblog%2Farchives%2F311" />
<link rel="alternate" type="text/xml+oembed" href="../wp-json/oembed/1.0/embedc841?url=http%3A%2F%2Fmatteo.vaccari.name%2Fblog%2Farchives%2F311&amp;format=xml" />
</head>
<body>
<div id="page">

<div id="header">
	<h1><a href="../../blog">Extreme Enthusiasm</a></h1>
</div>

<div id='maincontent'>
    <div id='main-col'>

  
		<div class="navigation">
			<div class="alignleft">&laquo; <a href="309.html" rel="prev">Niente Shore né Larsen</a></div>
			<div class="alignright"><a href="325.html" rel="next">Next speaking engagements</a> &raquo;</div>
		</div>

		<div class="post" id="post-311">
			<h2><a href="311.html" rel="bookmark" title="Permanent Link: Report of the first run of the OCP kata">Report of the first run of the OCP kata</a></h2>

			<div class="entrytext">
				<p>Two weeks ago we had our first meeting of the Milano Coding Dojo.  It was great fun, and I was honored to see Giordano had prepared <a href="http://giordano.scalzo.biz/2010/02/06/milano-xpug-january-coding-dojo/">such a good presentation</a> mentioning, among other things, the &#8220;OCP Kata&#8221; of my <a href="293.html">earlier blog post</a>.  The &#8220;Open Closed Principle&#8221; says that we should be able to add new feature by adding code, not by changing existing code (with an exception made for the place where the objects are created; after all, for the new class to be used, it must be instantiated somewhere.)  The OCP Kata is a set of rules, to be used in a training session, that force us to apply the OCP.
</p>
<p>So this was not only the first test-drive of this Dojo, but also of the OCP Kata.  How did it go?
</p>
<p>We worked randori-style on the Yathzee kata.  My impressions follow.
</p>
<h4>On the OCP Kata rules</h4>
<p>The OCP Kata was an influence only for the first test (forced us to use an explicit factory) and the second test (forced us to apply the OCP).  After that, the OCP rules did not fire, as the problem was naturally easy to be solved in OCP style.  After all, it was the implementation of a series of scoring rules for the Yathzee game.  Once you have the scoring rules machinery in place, everything else can be completed just by adding a new class (and modifying the factory).</p>
<h4>One class, many uses</h4>
<p>    We must always keep an eye on the design.  The complexity of the code kept going up, until we worked hard at removing duplication.  The OCP rules do not produce a good design by themselves.  Early in the kata, the rule for &#8220;twos&#8221; was the same as the rule for &#8220;threes&#8221; with 3 in place of 2.  The solution was to create a SingleNumberRule that takes the number in the constructor.  We avoided making two classes, when a single class could be used in different context with different configuration.      </p>
<p>    The driving force was <em>removing duplication</em>.
</p>
<h4>More duplication</h4>
<p>    Later, we had a lot of duplication between the &#8220;pair&#8221; rule, and the &#8220;double pair&#8221; rule.  The code that looks for a pair is needed in both rules.  An old-school OO programmer would have made the two rules derive from a common, abstract base class.  The abstract base class would be a repository for shared methods.  Modern OO programmers know to use inheritance only as a last resort.  So what could we do to remove duplication without inheritance?  One key observation was that most of that duplicated code was looking heavily into the array of rolls.  When you have code that uses heavily a data structure, it&#8217;s a good idea to move both data structure and code in an object.
</p>
<p>
    The natural name for that object is &#8220;hand&#8221;, so we created a Hand class that wraps the array of die rolls.  The duplicated code disappeared.
</p>
<p>    The driving forces were <em>removing duplication</em> and <em>avoiding direct access to data</em>.
</p>
<h4>Finding abstractions</h4>
<p>    The code in the Hand class was still not good enough.  It was <a href="174.html">full of loops</a>.  There was no flash of insight here, we just applied a few &#8220;extract method&#8221;s that moved each loop in its own little method.  Once we did that, we realized that some loops depended on another one that counts the occurrences of each number in the hand.  For instance, the occurrences in the hand (1, 1, 3, 3, 4) are (2, 0, 2, 1, 0, 0).  This is a key abstraction in this domain.
</p>
<p>    The other abstraction that is needed to implement the pair rule is &#8220;find me the highest pair&#8221;, which is just max{i | occurrences(i) &ge; 2}.  (It is not enough to score *any* pair.  It must be the highest pair, if more are present.)
</p>
<p>    To implement the &#8220;double pair&#8221; rule, we need a way to say &#8220;find the second highest pair&#8221;.  One way to say this is that if the highest pair is, say, 4, we must look for the highest pair that is less then 4.  The method we need is
</p>
<pre>
    public int highestPairLessThen(int n) {
       return max{i | occurrences(i) &ge; 2 &amp;&amp; i &lt; n};
    }
</pre>
<p>Now the two pairs rule was easy to implement:</p>
<pre>
    public int highestPair() {
      return highestPairLessThen(7);
    }
    
    public int secondHighestPair() {
      return highestPairLessThen(highestPair());
    }
</pre>
<p>The solution here was to find the right abstractions, and implement complex things in terms of simple things.  It&#8217;s a bit of functional programming in the small.  </p>
<h4>Conclusions</h4>
<p>The goal of good design is to have simple building blocks that can be combined together to create complex things.  When we are at the object-talking-to-other-objects level, the OCP principles guides us to invent object abstractions.  When we are in the small, within-the-object level, it&#8217;s good to apply some mathematical thinking.  It&#8217;s not deep, difficult mathematics.  It&#8217;s just a game of finding the right definitions, and using them to express complex things in terms of simpler things.</p>
<p>
  <strong>Update: cleaned up HTML, added headings</strong></p>

				
				<p class="postmetadata alt">
					<small>
						This entry was posted
												on 23 February 2010 at 21:49						and is filed under <a href="category/agile.html" rel="category tag">Agile</a>, <a href="category/expressive-code.html" rel="category tag">Expressive Code</a>.
						You can follow any responses to this entry through the <a href="311/feed">RSS 2.0</a> feed.

													You can <a href="#respond">leave a response</a>, or <a href="311/trackback" rel="trackback">trackback</a> from your own site.

						
					</small>
				</p>

			</div>
		</div>

	
<!-- You can start editing here. -->

	<h3 id="comments">One Response to &#8220;Report of the first run of the OCP kata&#8221;</h3> 

	<ol class="commentlist">

	
		<li class="alt" id="comment-93078">
			<cite><a href='http://andreamoz.blogspot.com/' rel='external nofollow' class='url'>Andrea Maietta</a></cite> Says:
						<br />

			<small class="commentmetadata"><a href="#comment-93078" title="">February 25th, 2010 at 15:26</a> </small>

			<p>Thanks for the post, as always very instructive for those who, like me, were not lucky enough to join the dojo</p>

		</li>

	
	
	</ol>

 


<h3 id="respond">Leave a Reply</h3>


<form action="http://matteo.vaccari.name/blog/wp-comments-post.php" method="post" id="commentform">


<p><input type="text" name="author" id="author" value="" size="22" tabindex="1" />
<label for="author"><small>Name (required)</small></label></p>

<p><input type="text" name="email" id="email" value="" size="22" tabindex="2" />
<label for="email"><small>Mail (will not be published) (required)</small></label></p>

<p><input type="text" name="url" id="url" value="" size="22" tabindex="3" />
<label for="url"><small>Website</small></label></p>


<!--<p><small><strong>XHTML:</strong> You can use these tags: &lt;a href=&quot;&quot; title=&quot;&quot;&gt; &lt;abbr title=&quot;&quot;&gt; &lt;acronym title=&quot;&quot;&gt; &lt;b&gt; &lt;blockquote cite=&quot;&quot;&gt; &lt;cite&gt; &lt;code&gt; &lt;del datetime=&quot;&quot;&gt; &lt;em&gt; &lt;i&gt; &lt;q cite=&quot;&quot;&gt; &lt;s&gt; &lt;strike&gt; &lt;strong&gt; </small></p>-->

<p><textarea name="comment" id="comment" cols="100%" rows="10" tabindex="4"></textarea></p>

<p><input name="submit" type="submit" id="submit" tabindex="5" value="Submit Comment" />
<input type="hidden" name="comment_post_ID" value="311" />
</p>
<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="11c0a868c0" /></p><p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="177"/></p>
</form>



	
    </div>

    <div id='right-col'>
        <div id="sidebar">
    <ul>

      <li>
        <form method="get" id="searchform" action="http://matteo.vaccari.name/blog/">
  <div>
    <input tabindex="1" type="text" value="" name="s" id="s" />
    <input type="submit" id="searchsubmit" value="Search" />
  </div>
</form>
      </li>

      <li>

        <h2>About</h2>

	I am a software developer working with <a href="http://thoughtworks.com/">Thoughtworks Italia</a>.
        I'm a fan of <a
        href="http://extremeprogramming.org/">Extreme Programming</a>.
        I&nbsp;helped organize the <a
        href="http://essap.dicom.uninsubria.it/">European Summer School on
        Agile Programming</a>

      </li>

      <li>
            </li>

      <li class="pagenav"><h2>Pages</h2><ul><li class="page_item page-item-851"><a href="../selected-tdd-resources-to-start.html">Selected TDD Resources To Start</a></li>
<li class="page_item page-item-583"><a href="../tdd-resources.html">TDD Resources</a></li>
<li class="page_item page-item-247"><a href="../the-hexagonal-architecture.html">The Hexagonal Architecture</a></li>
</ul></li>

      
      <li><h2>Archives</h2>
        <ul>
        	<li><a href='date/2018/10.html'>October 2018</a></li>
	<li><a href='date/2017/09.html'>September 2017</a></li>
	<li><a href='date/2016/08.html'>August 2016</a></li>
	<li><a href='date/2016/03.html'>March 2016</a></li>
	<li><a href='date/2016/01.html'>January 2016</a></li>
	<li><a href='date/2014/12.html'>December 2014</a></li>
	<li><a href='date/2014/10.html'>October 2014</a></li>
	<li><a href='date/2014/06.html'>June 2014</a></li>
	<li><a href='date/2014/02.html'>February 2014</a></li>
	<li><a href='date/2013/12.html'>December 2013</a></li>
	<li><a href='date/2013/11.html'>November 2013</a></li>
	<li><a href='date/2013/06.html'>June 2013</a></li>
	<li><a href='date/2013/05.html'>May 2013</a></li>
	<li><a href='date/2013/03.html'>March 2013</a></li>
	<li><a href='date/2013/02.html'>February 2013</a></li>
	<li><a href='date/2012/10.html'>October 2012</a></li>
	<li><a href='date/2012/08.html'>August 2012</a></li>
	<li><a href='date/2012/07.html'>July 2012</a></li>
	<li><a href='date/2012/06.html'>June 2012</a></li>
	<li><a href='date/2012/05.html'>May 2012</a></li>
	<li><a href='date/2012/04.html'>April 2012</a></li>
	<li><a href='date/2012/01.html'>January 2012</a></li>
	<li><a href='date/2011/12.html'>December 2011</a></li>
	<li><a href='date/2011/11.html'>November 2011</a></li>
	<li><a href='date/2011/10.html'>October 2011</a></li>
	<li><a href='date/2011/07.html'>July 2011</a></li>
	<li><a href='date/2011/06.html'>June 2011</a></li>
	<li><a href='date/2011/05.html'>May 2011</a></li>
	<li><a href='date/2011/04.html'>April 2011</a></li>
	<li><a href='date/2011/03.html'>March 2011</a></li>
	<li><a href='date/2011/02.html'>February 2011</a></li>
	<li><a href='date/2010/11.html'>November 2010</a></li>
	<li><a href='date/2010/10.html'>October 2010</a></li>
	<li><a href='date/2010/09.html'>September 2010</a></li>
	<li><a href='date/2010/08.html'>August 2010</a></li>
	<li><a href='date/2010/07.html'>July 2010</a></li>
	<li><a href='date/2010/06.html'>June 2010</a></li>
	<li><a href='date/2010/05.html'>May 2010</a></li>
	<li><a href='date/2010/04.html'>April 2010</a></li>
	<li><a href='date/2010/03.html'>March 2010</a></li>
	<li><a href='date/2010/02.html'>February 2010</a></li>
	<li><a href='date/2010/01.html'>January 2010</a></li>
	<li><a href='date/2009/12.html'>December 2009</a></li>
	<li><a href='date/2009/11.html'>November 2009</a></li>
	<li><a href='date/2009/10.html'>October 2009</a></li>
	<li><a href='date/2009/09.html'>September 2009</a></li>
	<li><a href='date/2009/07.html'>July 2009</a></li>
	<li><a href='date/2009/05.html'>May 2009</a></li>
	<li><a href='date/2009/04.html'>April 2009</a></li>
	<li><a href='date/2009/03.html'>March 2009</a></li>
	<li><a href='date/2009/02.html'>February 2009</a></li>
	<li><a href='date/2009/01.html'>January 2009</a></li>
	<li><a href='date/2008/12.html'>December 2008</a></li>
	<li><a href='date/2008/11.html'>November 2008</a></li>
	<li><a href='date/2008/10.html'>October 2008</a></li>
	<li><a href='date/2008/09.html'>September 2008</a></li>
	<li><a href='date/2008/07.html'>July 2008</a></li>
	<li><a href='date/2008/06.html'>June 2008</a></li>
	<li><a href='date/2008/05.html'>May 2008</a></li>
	<li><a href='date/2008/04.html'>April 2008</a></li>
	<li><a href='date/2008/01.html'>January 2008</a></li>
	<li><a href='date/2007/11.html'>November 2007</a></li>
	<li><a href='date/2007/10.html'>October 2007</a></li>
	<li><a href='date/2007/09.html'>September 2007</a></li>
	<li><a href='date/2007/06.html'>June 2007</a></li>
	<li><a href='date/2007/05.html'>May 2007</a></li>
	<li><a href='date/2007/04.html'>April 2007</a></li>
	<li><a href='date/2007/03.html'>March 2007</a></li>
	<li><a href='date/2007/02.html'>February 2007</a></li>
	<li><a href='date/2007/01.html'>January 2007</a></li>
	<li><a href='date/2006/12.html'>December 2006</a></li>
	<li><a href='date/2006/11.html'>November 2006</a></li>
	<li><a href='date/2006/10.html'>October 2006</a></li>
	<li><a href='date/2006/09.html'>September 2006</a></li>
	<li><a href='date/2006/08.html'>August 2006</a></li>
	<li><a href='date/2006/07.html'>July 2006</a></li>
	<li><a href='date/2006/06.html'>June 2006</a></li>
	<li><a href='date/2006/05.html'>May 2006</a></li>
	<li><a href='date/2006/04.html'>April 2006</a></li>
	<li><a href='date/2006/03.html'>March 2006</a></li>
	<li><a href='date/2006/02.html'>February 2006</a></li>
	<li><a href='date/2006/01.html'>January 2006</a></li>
        </ul>
      </li>

      <li><h2>Categories</h2>
        <ul>
        	<li class="cat-item cat-item-1"><a href="category/agile.html" >Agile</a> (229)
</li>
	<li class="cat-item cat-item-3"><a href="category/books.html" >Books</a> (2)
</li>
	<li class="cat-item cat-item-11"><a href="category/design-exercise.html" >Design Exercise</a> (5)
</li>
	<li class="cat-item cat-item-6"><a href="category/essay.html" >Essay</a> (13)
</li>
	<li class="cat-item cat-item-8"><a href="category/expressive-code.html" >Expressive Code</a> (11)
</li>
	<li class="cat-item cat-item-10"><a href="category/fundamentals.html" >Fundamentals</a> (6)
</li>
	<li class="cat-item cat-item-9"><a href="category/other.html" >other</a> (1)
</li>
        </ul>
      </li>

      
    </ul>
  </div>

    </div>
</div>


<hr />
<div id="footer">
<address>
  <script type="text/javascript">eval(unescape('%64%6f%63%75%6d%65%6e%74%2e%77%72%69%74%65%28%27%3c%61%20%68%72%65%66%3d%22%6d%61%69%6c%74%6f%3a%76%61%63%63%61%72%69%40%70%6f%62%6f%78%2e%63%6f%6d%22%3e%76%61%63%63%61%72%69%40%70%6f%62%6f%78%2e%63%6f%6d%3c%2f%61%3e%27%29%3b'))</script>
</address>
</div>
</div>
  <script type='text/javascript' src='../wp-includes/js/wp-embed.min3c21.js?ver=5.1.1'></script>
<script async="async" type='text/javascript' src='../wp-content/plugins/akismet/_inc/form0235.js?ver=4.1.1'></script>
</body>

<!-- Mirrored from matteo.vaccari.name/blog/archives/311 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 24 Sep 2021 10:24:49 GMT -->
</html>
